{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–ª—É—á–∞–π–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞</title>
    <link rel="stylesheet" href="{% static 'quotes_app/css/style.css' %}">
</head>
<body>
<div class="container">

    <h1>–°–ª—É—á–∞–π–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞</h1>

    <div class="card">
        <blockquote>
            <p>{{ quote.text }}</p>
            <footer class="blockquote-footer">–ò—Å—Ç–æ—á–Ω–∏–∫(–∞–≤—Ç–æ—Ä): {{ quote.source }}</footer>
        </blockquote>
        <hr>
        <p id="stats">üëÅ {{ quote.views }} | üëç <span id="likes">{{ quote.likes_count }}</span> | üëé <span id="dislikes">{{ quote.dislikes_count }}</span></p>

        <div>
            <button id="like-btn" class="btn {% if user_vote and user_vote.value == 1 %}btn-primary{% else %}btn-outline{% endif %}">üëç –õ–∞–π–∫</button>
            <button id="dislike-btn" class="btn {% if user_vote and user_vote.value == -1 %}btn-primary{% else %}btn-outline{% endif %}">üëé –î–∏–∑–ª–∞–π–∫</button>
        </div>
    </div>

    <div class="text-center">
        <a href="{% url 'add_quote' %}" class="btn btn-outline">–î–æ–±–∞–≤–∏—Ç—å —Ü–∏—Ç–∞—Ç—É</a>
        <a href="{% url 'top_10' %}" class="btn btn-outline">–¢–æ–ø-10</a>
    </div>

</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const likeBtn = document.getElementById("like-btn");
    const dislikeBtn = document.getElementById("dislike-btn");

    function sendVote(type) {
        fetch("{% url 'vote_quote' quote.id 'TYPE' %}".replace("TYPE", type))
            .then(response => response.json())
            .then(data => {
                // –æ–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫–∏
                document.getElementById("likes").textContent = data.likes;
                document.getElementById("dislikes").textContent = data.dislikes;

                // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏
                likeBtn.classList.remove("btn-primary");
                likeBtn.classList.add("btn-outline");
                dislikeBtn.classList.remove("btn-primary");
                dislikeBtn.classList.add("btn-outline");

                // –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –µ—Å–ª–∏ –≥–æ–ª–æ—Å –µ—Å—Ç—å
                if (data.user_vote === 1) {
                    likeBtn.classList.add("btn-primary");
                    likeBtn.classList.remove("btn-outline");
                } else if (data.user_vote === -1) {
                    dislikeBtn.classList.add("btn-primary");
                    dislikeBtn.classList.remove("btn-outline");
                }
            });
    }

    likeBtn.addEventListener("click", () => sendVote("like"));
    dislikeBtn.addEventListener("click", () => sendVote("dislike"));
});
</script>

</body>
</html>
