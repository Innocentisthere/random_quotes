{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Ğ¡Ğ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ°Ñ Ñ†Ğ¸Ñ‚Ğ°Ñ‚Ğ°</title>
    <link rel="stylesheet" href="{% static 'quotes_app/css/style.css' %}">
</head>
<body>
<div class="container">

    <h1>Ğ¡Ğ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ°Ñ Ñ†Ğ¸Ñ‚Ğ°Ñ‚Ğ°</h1>

    <div class="card">
        <blockquote>
            <p>{{ quote.text }}</p>
            <footer class="blockquote-footer">Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº(Ğ°Ğ²Ñ‚Ğ¾Ñ€): {{ quote.source }}</footer>
        </blockquote>
        <hr>
        <p id="stats">ğŸ‘ {{ quote.views }} | ğŸ‘ <span id="likes">{{ quote.likes_count }}</span> | ğŸ‘ <span id="dislikes">{{ quote.dislikes_count }}</span></p>

        <div>
            <button id="like-btn" class="btn {% if user_vote and user_vote.value == 1 %}btn-primary{% else %}btn-outline{% endif %}">ğŸ‘ Ğ›Ğ°Ğ¹Ğº</button>
            <button id="dislike-btn" class="btn {% if user_vote and user_vote.value == -1 %}btn-primary{% else %}btn-outline{% endif %}">ğŸ‘ Ğ”Ğ¸Ğ·Ğ»Ğ°Ğ¹Ğº</button>
        </div>
    </div>

    <div class="text-center">
        <a href="{% url 'add_quote' %}" class="btn btn-outline">â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ†Ğ¸Ñ‚Ğ°Ñ‚Ñƒ</a>
        <a href="{% url 'top_10' %}" class="btn btn-outline">ğŸ† Ğ¢Ğ¾Ğ¿-10</a>
    </div>

</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const likeBtn = document.getElementById("like-btn");
    const dislikeBtn = document.getElementById("dislike-btn");

    function sendVote(type) {
        fetch("{% url 'vote_quote' quote.id 'TYPE' %}".replace("TYPE", type))
            .then(response => response.json())
            .then(data => {
                // Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸ĞºĞ¸
                document.getElementById("likes").textContent = data.likes;
                document.getElementById("dislikes").textContent = data.dislikes;

                // ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸
                likeBtn.classList.remove("btn-primary");
                likeBtn.classList.add("btn-outline");
                dislikeBtn.classList.remove("btn-primary");
                dislikeBtn.classList.add("btn-outline");

                // Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‡Ğ¸Ğ²Ğ°ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ ĞµÑĞ»Ğ¸ Ğ³Ğ¾Ğ»Ğ¾Ñ ĞµÑÑ‚ÑŒ
                if (data.user_vote === 1) {
                    likeBtn.classList.add("btn-primary");
                    likeBtn.classList.remove("btn-outline");
                } else if (data.user_vote === -1) {
                    dislikeBtn.classList.add("btn-primary");
                    dislikeBtn.classList.remove("btn-outline");
                }
            });
    }

    likeBtn.addEventListener("click", () => sendVote("like"));
    dislikeBtn.addEventListener("click", () => sendVote("dislike"));
});
</script>

</body>
</html>
