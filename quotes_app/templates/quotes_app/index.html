{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Случайная цитата</title>
    <link rel="stylesheet" href="{% static 'quotes_app/css/style.css' %}">
</head>
<body>
<div class="container">

    <h1>Случайная цитата</h1>

    <div class="card">
        <blockquote>
            <p>{{ quote.text }}</p>
            <footer class="blockquote-footer">Источник(автор): {{ quote.source }}</footer>
        </blockquote>
        <hr>
        <p id="stats">👁 {{ quote.views }} | 👍 <span id="likes">{{ quote.likes_count }}</span> | 👎 <span id="dislikes">{{ quote.dislikes_count }}</span></p>

        <div>
            <button id="like-btn" class="btn {% if user_vote and user_vote.value == 1 %}btn-primary{% else %}btn-outline{% endif %}">👍 Лайк</button>
            <button id="dislike-btn" class="btn {% if user_vote and user_vote.value == -1 %}btn-primary{% else %}btn-outline{% endif %}">👎 Дизлайк</button>
        </div>
    </div>

    <div class="text-center">
        <a href="{% url 'add_quote' %}" class="btn btn-outline">➕ Добавить цитату</a>
        <a href="{% url 'top_10' %}" class="btn btn-outline">🏆 Топ-10</a>
    </div>

</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const likeBtn = document.getElementById("like-btn");
    const dislikeBtn = document.getElementById("dislike-btn");

    function sendVote(type) {
        fetch("{% url 'vote_quote' quote.id 'TYPE' %}".replace("TYPE", type))
            .then(response => response.json())
            .then(data => {
                // обновляем счётчики
                document.getElementById("likes").textContent = data.likes;
                document.getElementById("dislikes").textContent = data.dislikes;

                // сбрасываем стили
                likeBtn.classList.remove("btn-primary");
                likeBtn.classList.add("btn-outline");
                dislikeBtn.classList.remove("btn-primary");
                dislikeBtn.classList.add("btn-outline");

                // подсвечиваем кнопку если голос есть
                if (data.user_vote === 1) {
                    likeBtn.classList.add("btn-primary");
                    likeBtn.classList.remove("btn-outline");
                } else if (data.user_vote === -1) {
                    dislikeBtn.classList.add("btn-primary");
                    dislikeBtn.classList.remove("btn-outline");
                }
            });
    }

    likeBtn.addEventListener("click", () => sendVote("like"));
    dislikeBtn.addEventListener("click", () => sendVote("dislike"));
});
</script>

</body>
</html>
